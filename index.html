<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberTrader | AI Stock Market</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="auth.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap');
        
        :root {
            --cyber-blue: #0a0a2a;
            --neon-teal: #00ffcc;
            --neon-purple: #cc00ff;
            --text-glow: 0 0 10px var(--neon-teal);
            --card-width: 220px;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--cyber-blue);
            color: white;
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            flex: 1;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--neon-teal);
            box-shadow: 0 0 15px var(--neon-teal);
            width: 100%;
            position: relative;
        }
        
        .header-left {
            flex: 1;
            display: flex;
            justify-content: flex-start;
        }
        
        .header-center {
            flex: 1;
            display: flex;
            justify-content: center;
        }
        
        .header-right {
            flex: 1;
            display: flex;
            justify-content: flex-end;
        }
        
        .simulation-btn {
            background: rgba(10, 10, 42, 0.7);
            border: 1px solid var(--neon-purple);
            color: var(--neon-purple);
            padding: 0.5rem 1rem;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .simulation-btn:hover {
            background: var(--neon-purple);
            color: white;
            box-shadow: 0 0 15px var(--neon-purple);
        }
        
        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--neon-teal);
            text-shadow: var(--text-glow);
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logo:hover {
            text-shadow: 0 0 15px var(--neon-teal);
        }
        
        .profile-btn {
            background: rgba(10, 10, 42, 0.7);
            border: 1px solid var(--neon-teal);
            color: white;
            padding: 0.5rem 1rem;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .profile-btn:hover {
            background: var(--neon-teal);
            color: var(--cyber-blue);
            text-shadow: none;
            box-shadow: 0 0 15px var(--neon-teal);
        }

        /* Bitcoin Ticker Styles */
        .bitcoin-ticker {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--neon-teal);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem auto;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.3);
            max-width: 800px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 1rem;
            flex-wrap: nowrap;
        }

        .ticker-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ticker-symbol {
            color: var(--neon-teal);
            text-shadow: 0 0 5px var(--neon-teal);
        }

        .ticker-price {
            font-weight: bold;
        }

        .ticker-change {
            margin-left: 0.3rem;
        }

        .ticker-volume {
            font-weight: bold;
        }
        
        /* Search Bar Styles */
        .search-container {
            display: flex;
            justify-content: center;
            margin: 0 auto 2rem;
            max-width: 800px;
            width: 100%;
        }
        
        .search-bar {
            width: 100%;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--neon-teal);
            border-radius: 8px;
            color: white;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.1);
        }
        
        .search-bar:focus {
            outline: none;
            border-color: var(--neon-purple);
            box-shadow: 0 0 20px var(--neon-purple);
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(5, 5, 23, 0.95);
            border: 1px solid var(--neon-teal);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        
        .search-result-item {
            padding: 0.8rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .search-result-item:hover {
            background: rgba(0, 255, 204, 0.1);
        }
        
        .search-result-symbol {
            color: var(--neon-teal);
            font-weight: bold;
            margin-right: 0.5rem;
        }
        
        /* Market Overview Section */
        .market-overview {
            padding: 1rem 0;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 60vh;
        }
        
        .section-title {
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-teal);
            margin: 1rem 0 2rem 0;
            text-shadow: var(--text-glow);
            font-size: 1.8rem;
        }
        
        /* Disclaimer Section */
        .disclaimer {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--neon-purple);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem auto;
            text-align: center;
            font-size: 0.9rem;
            color: #aaa;
            max-width: 800px;
            width: 100%;
        }
        
        /* Scroller Navigation Wrapper */
        .navigation-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-bottom: 2rem;
            position: relative;
        }

        .scroll-arrow {
            background-color: rgba(10, 10, 42, 0.7);
            color: var(--neon-teal);
            border: 1px solid var(--neon-teal);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.8rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
            z-index: 10;
            flex-shrink: 0;
            margin: 0 1rem;
        }
        
        .scroll-arrow:hover {
            background: var(--neon-teal);
            color: var(--cyber-blue);
            box-shadow: 0 0 15px var(--neon-teal);
        }
        
        .scroll-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Manual Horizontal Scroller */
        .scroller {
            width: 100%;
            height: 320px;
            position: relative;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            cursor: grab;
            flex-grow: 1;
            min-width: 0;
            overflow-y: hidden;
            will-change: transform;
            backface-visibility: hidden;
            transform: translate3d(0,0,0);
            contain: strict;
        }
        
        .scroller-inner {
            display: flex;
            gap: 2rem;
            padding: 0 3rem;
            height: 100%;
            align-items: center;
            will-change: transform;
            backface-visibility: hidden;
        }
        
        .scroller::-webkit-scrollbar {
            height: 10px;
        }
        
        .scroller::-webkit-scrollbar-track {
            background: rgba(0, 255, 204, 0.1);
        }
        
        .scroller::-webkit-scrollbar-thumb {
            background: var(--neon-teal);
            border-radius: 5px;
        }
        
        /* Stock Card - Now with company logos */
        .stock-card {
            flex: 0 0 var(--card-width);
            height: 280px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--neon-teal);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            cursor: pointer;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.4);
            scroll-snap-align: center;
            overflow: hidden;
            will-change: transform;
            backface-visibility: hidden;
            transform: translate3d(0,0,0);
            contain: content;
        }
        
        .stock-card:hover {
            transform: translateY(-5px) scale(1.05) translateZ(0);
            box-shadow: 0 0 30px var(--neon-teal);
            height: 280px;
        }

        .stock-logo-container {
            width: 120px;
            height: 120px;
            margin-bottom: 1rem;
            position: relative;
            transition: all 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stock-logo {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
            border: 2px solid var(--neon-teal);
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.4);
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 5px;
            transform: translateZ(0);
        }

        .stock-card:hover .stock-logo {
            box-shadow: 0 0 30px var(--neon-teal);
            transform: scale(1.05) translateZ(0);
        }
        
        .stock-name {
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: white;
            text-align: center;
            font-size: 1.2rem;
            transition: all 0.3s ease-out;
        }
        
        .stock-symbol {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-teal);
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
            text-shadow: 0 0 5px var(--neon-teal);
        }
        
        .stock-price {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            transition: all 0.3s ease-out;
        }
        
        .price-up {
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
        }
        
        .price-down {
            color: #ff0066;
            text-shadow: 0 0 10px #ff0066;
        }
        
        /* AI Analysis Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            overflow-y: auto;
        }
        
        .modal-content {
            background: var(--cyber-blue);
            margin: 2rem auto;
            padding: 2rem;
            max-width: 800px;
            border: 1px solid var(--neon-purple);
            box-shadow: 0 0 30px var(--neon-purple);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .company-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .modal-logo-container {
            width: 80px;
            height: 80px;
            margin-right: 1.5rem;
        }
        
        .modal-logo {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
            border: 2px solid var(--neon-teal);
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.4);
            background-color: rgba(0, 0, 0, 0.3);
            padding: 3px;
        }
        
        .company-info h2 {
            margin: 0;
            color: var(--neon-teal);
            font-family: 'Orbitron', sans-serif;
        }
        
        .current-price {
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }
        
        .ai-analysis {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid var(--neon-purple);
        }
        
        .ai-title {
            color: var(--neon-purple);
            font-family: 'Orbitron', sans-serif;
            margin-top: 0;
        }
        
        .cnn-chart-container {
            width: 100%;
            height: 500px;
            margin: 1rem 0 2rem 0;
            border: 1px solid var(--neon-teal);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .cnn-chart {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .buy-recommendation {
            text-align: center;
            margin: 3rem 0;
            padding: 2rem;
            border-top: 1px solid var(--neon-teal);
            border-bottom: 1px solid var(--neon-teal);
        }
        
        .buy-question {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: white;
            margin-bottom: 1.5rem;
        }
        
        .buy-answer {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 1rem 2rem;
            border-radius: 5px;
            display: inline-block;
            position: relative;
        }
        
        .buy-answer.blurred {
            filter: blur(5px);
            color: transparent !important;
            text-shadow: 0 0 8px rgba(255,255,255,0.5) !important;
            background: rgba(255,255,255,0.1) !important;
            border: 1px solid rgba(255,255,255,0.2) !important;
            box-shadow: none !important;
            cursor: pointer;
        }
        
        .sign-in-prompt {
            color: var(--neon-teal);
            font-size: 1rem;
            margin-top: 0.5rem;
            text-align: center;
            text-shadow: 0 0 5px var(--neon-teal);
            cursor: pointer;
            transition: all 0.3s;
        }

        .sign-in-prompt:hover {
            text-shadow: 0 0 10px var(--neon-teal);
        }
        
        .buy-yes {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }
        
        .buy-no {
            background: rgba(255, 0, 102, 0.2);
            color: #ff0066;
            border: 1px solid #ff0066;
            box-shadow: 0 0 20px rgba(255, 0, 102, 0.5);
        }
        
        .buy-hold {
            background: rgba(255, 255, 0, 0.2);
            color: #ffff00;
            border: 1px solid #ffff00;
            box-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
        }
        
        /* News articles styling */
        .news-container {
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .news-article {
            padding: 1rem;
            margin-bottom: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-left: 2px solid var(--neon-teal);
        }
        
        .news-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--neon-teal);
        }
        
        .news-source {
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 0.5rem;
        }
        
        .news-summary {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .news-date {
            font-size: 0.8rem;
            color: #777;
        }
        
        .news-sentiment {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }
        
        .sentiment-positive {
            background-color: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }
        
        .sentiment-negative {
            background-color: rgba(255, 0, 0, 0.1);
            color: #ff0000;
        }
        
        .sentiment-neutral {
            background-color: rgba(255, 255, 0, 0.1);
            color: #ffff00;
        }
        
        /* Grid Background */
        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(rgba(0, 255, 204, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 204, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            pointer-events: none;
            z-index: -1;
        }
        
        /* Data Connection Status */
        .connection-status {
            position: fixed;
            bottom: 4rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--neon-teal);
            border-radius: 5px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
        }
        
        .connected {
            color: #00ff88;
            text-shadow: 0 0 5px #00ff88;
        }
        
        .disconnected {
            color: #ff0066;
            text-shadow: 0 0 5px #ff0066;
        }

        /* Real-time ticker */
        .ticker-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid var(--neon-teal);
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.3);
            overflow: hidden;
            z-index: 90;
            height: 40px;
        }

        .ticker {
            display: flex;
            align-items: center;
            height: 100%;
            white-space: nowrap;
            animation: ticker-scroll 30s linear infinite;
        }

        .ticker-item {
            display: flex;
            align-items: center;
            margin-right: 2rem;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
        }

        .ticker-symbol {
            margin-right: 0.5rem;
            color: var(--neon-teal);
        }

        .ticker-price {
            font-weight: bold;
        }

        .ticker-change {
            margin-left: 0.5rem;
        }

        .price-up {
            color: #00ff88;
        }

        .price-down {
            color: #ff0066;
        }

        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        /* Hover scrolling */
        .scroller:hover {
            cursor: grab;
        }

        .scroller:active {
            cursor: grabbing;
        }
        
        /* Technical Analysis Tooltip */
        .analysis-tooltip {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--neon-teal);
            border-radius: 5px;
            padding: 5px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .stock-card:hover .analysis-tooltip {
            opacity: 1;
        }

        .analysis-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }

        .analysis-label {
            color: #aaa;
        }

        .analysis-value {
            color: white;
            font-family: 'Orbitron', sans-serif;
        }

        .analysis-value.up {
            color: #00ff88;
        }

        .analysis-value.down {
            color: #ff0066;
        }

        .analysis-value.overbought {
            color: #ff0066;
            text-shadow: 0 0 5px #ff0066;
        }

        .analysis-value.oversold {
            color: #00ff88;
            text-shadow: 0 0 5px #00ff88;
        }
    </style>
</head>
<body>
    <div class="grid-overlay"></div>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <button class="simulation-btn" onclick="window.location.href='simulation/simulation.html'">Simulation Mode</button>
            </div>
            <div class="header-center">
                <div class="logo" onclick="window.location.href='index.html'">CyberTRADER</div>
            </div>
            <div class="header-right">
                <button class="profile-btn" id="profileBtn">PROFILE</button>
            </div>
        </header>
        
        <main class="market-overview">
            <h2 class="section-title">MARKET OVERVIEW</h2>
            
            <!-- Bitcoin ticker in one line -->
            <div class="bitcoin-ticker">
                <div class="ticker-item">
                    <span class="ticker-symbol">BTC/USD:</span>
                    <span class="ticker-price" id="btc-price">$106,816</span>
                </div>
                <div class="ticker-item">
                    <span class="ticker-change price-up" id="btc-change">122%</span>
                </div>
                <div class="ticker-item">
                    <span class="ticker-symbol">24h VOL:</span>
                    <span class="ticker-volume" id="btc-volume">$46124.21M</span>
                </div>
            </div>
            
            <!-- Search bar -->
            <div class="search-container">
                <div style="position: relative; width: 100%;">
                    <input type="text" class="search-bar" id="stockSearch" placeholder="Search any stock symbol (e.g. AAPL, TSLA, GME)">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
            
            <!-- Disclaimer Section -->
            <div class="disclaimer">
                All financial decisions are ultimately yours. Cyber Trader is not responsible for any financial loss that may occur.
            </div>
            
            <!-- Horizontal Scroller with Navigation -->
            <div class="navigation-wrapper">
                <button id="scroll-left" class="scroll-arrow" aria-label="Scroll Left">&lt;</button>
                
                <!-- Manual Horizontal Scroller -->
                <div class="scroller" id="stock-scroller">
                    <div class="scroller-inner">
                        <!-- Tech Companies -->
                        <div class="stock-card" data-ticker="AAPL">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/AAPL.D-149adf35.png?t=1720244490" alt="Apple" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=AAPL'">
                            </div>
                            <h3 class="stock-name">Apple Inc.</h3>
                            <div class="stock-symbol">AAPL</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="MSFT">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/MSFT_BIG-24b887c2.png?t=1722952497" alt="Microsoft" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=MSFT'">
                            </div>
                            <h3 class="stock-name">Microsoft</h3>
                            <div class="stock-symbol">MSFT</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="GOOGL">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/GOOG_BIG-63cbd9c6.png?t=1722952493" alt="Alphabet" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=GOOGL'">
                            </div>
                            <h3 class="stock-name">Alphabet</h3>
                            <div class="stock-symbol">GOOGL</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="AMZN">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/AMZN_BIG.D-8fb0be81.png?t=1740113564" alt="Amazon" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=AMZN'">
                            </div>
                            <h3 class="stock-name">Amazon</h3>
                            <div class="stock-symbol">AMZN</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="TSLA">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/TSLA-6da550e5.png?t=1740128273" alt="Tesla" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=TSLA'">
                            </div>
                            <h3 class="stock-name">Tesla</h3>
                            <div class="stock-symbol">TSLA</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="NVDA">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/NVDA_BIG.D-ffbdc3fe.png?t=1722952498" alt="NVIDIA" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=NVDA'">
                            </div>
                            <h3 class="stock-name">NVIDIA</h3>
                            <div class="stock-symbol">NVDA</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="META">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/META-4767da84.png?t=1720244492" alt="Meta" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=META'">
                            </div>
                            <h3 class="stock-name">Meta</h3>
                            <div class="stock-symbol">META</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        
                        <!-- Financial Companies -->
                        <div class="stock-card" data-ticker="JPM">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/JPM_BIG.D-62c873ed.png?t=1720244492" alt="JPMorgan" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=JPM'">
                            </div>
                            <h3 class="stock-name">JPMorgan</h3>
                            <div class="stock-symbol">JPM</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="V">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/V-05214186.png?t=1720244494" alt="Visa" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=V'">
                            </div>
                            <h3 class="stock-name">Visa</h3>
                            <div class="stock-symbol">V</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="PYPL">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/PYPL_BIG-9eda417b.png?t=1720244493" alt="PayPal" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=PYPL'">
                            </div>
                            <h3 class="stock-name">PayPal</h3>
                            <div class="stock-symbol">PYPL</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        
                        <!-- Consumer Goods -->
                        <div class="stock-card" data-ticker="WMT">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/WMT_BIG-4dae0070.png?t=1737085433" alt="Walmart" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=WMT'">
                            </div>
                            <h3 class="stock-name">Walmart</h3>
                            <div class="stock-symbol">WMT</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="KO">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/KO-b23a2a5e.png?t=1720244492" alt="Coca-Cola" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=KO'">
                            </div>
                            <h3 class="stock-name">Coca-Cola</h3>
                            <div class="stock-symbol">KO</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="PEP">
                            <div class="stock-logo-container">
                                <img src="https://logo.clearbit.com/pepsi.com" alt="Pepsi" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=PEP'">
                            </div>
                            <h3 class="stock-name">Pepsi</h3>
                            <div class="stock-symbol">PEP</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="NKE">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/NKE.D-14bad6cf.png?t=1720244493" alt="Nike" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=NKE'">
                            </div>
                            <h3 class="stock-name">Nike</h3>
                            <div class="stock-symbol">NKE</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        
                        <!-- Entertainment & Media -->
                        <div class="stock-card" data-ticker="DIS">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/DIS_BIG.D-008fa6d9.png?t=1727153862" alt="Disney" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=DIS'">
                            </div>
                            <h3 class="stock-name">Disney</h3>
                            <div class="stock-symbol">DIS</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                        <div class="stock-card" data-ticker="NFLX">
                            <div class="stock-logo-container">
                                <img src="https://companieslogo.com/img/orig/NFLX_BIG-1095e4f6.png?t=1720244493" alt="Netflix" class="stock-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/120?text=NFLX'">
                            </div>
                            <h3 class="stock-name">Netflix</h3>
                            <div class="stock-symbol">NFLX</div>
                            <div class="stock-price">Loading...</div>
                            <div class="analysis-tooltip"></div>
                        </div>
                    </div>
                </div>
                
                <button id="scroll-right" class="scroll-arrow" aria-label="Scroll Right">&gt;</button>
            </div>
        </main>
    </div>

    <!-- Real-time ticker -->
    <div class="ticker-container">
        <div class="ticker" id="stock-ticker"></div>
    </div>
    
    <!-- AI Analysis Modal -->
    <div id="analysisModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">×</button>
            
            <div class="company-header">
                <div class="modal-logo-container">
                    <img id="modalLogo" src="" alt="Company Logo" class="modal-logo" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/80?text=LOGO'">
                </div>
                <div class="company-info">
                    <h2 id="companyName">COMPANY NAME</h2>
                    <div class="current-price" id="currentPrice">$0.00 (0.00%)</div>
                </div>
            </div>
            
            <div class="ai-analysis">
                <h3 class="ai-title">Cyber AI ANALYSIS</h3>
                <p id="aiSummary">Loading Cyber analysis... Our AI is currently evaluating market trends, recent news, technical indicators, and fundamental data to provide you with the most accurate assessment.</p>
                
                <h4>LIVE PRICE CHART</h4>
                <div class="cnn-chart-container">
                    <iframe class="cnn-chart" id="cnnChart" src="" frameborder="0"></iframe>
                </div>
                
                <h4>KEY METRICS</h4>
                <ul id="keyMetrics">
                    <li>Loading financial data...</li>
                </ul>
                
                <h4>RECENT NEWS SENTIMENT</h4>
                <div id="newsSentimentContainer">
                    <p id="newsSentiment">Analyzing latest headlines...</p>
                    <div class="news-container" id="newsArticles"></div>
                </div>
            </div>
            
            <div class="buy-recommendation">
                <div class="buy-question">SHOULD I BUY THIS STOCK?</div>
                <div class="buy-answer blurred" id="buyRecommendation">
                    Cyber AI PROCESSING...
                </div>
                <div class="sign-in-prompt" onclick="redirectToLogin()">Sign in to view the answer</div>
            </div>
        </div>
    </div>
    
    <div id="connectionStatus" class="connection-status disconnected">
        DATA: DISCONNECTED
    </div>
    
    <script>
        // Configuration
        const FINNHUB_API_KEY = 'd0uelbpr01qn5fk4u25gd0uelbpr01qn5fk4u260';
        const MARKETAUX_API_KEY = 'dVeLAjrTcKb9oM7vcDlmkOCJdEyEruh5WhwAOwyJ';
        const COINGECKO_API_URL = 'https://api.coingecko.com/api/v3/';
        const connectionStatus = document.getElementById('connectionStatus');
        const tickerContainer = document.getElementById('stock-ticker');

        // Tracked stocks with their full names and logo URLs
        const trackedStocks = {
            'AAPL': { name: 'Apple Inc.', logo: 'https://companieslogo.com/img/orig/AAPL.D-149adf35.png?t=1720244490' },
            'MSFT': { name: 'Microsoft Corporation', logo: 'https://companieslogo.com/img/orig/MSFT_BIG-24b887c2.png?t=1722952497' },
            'GOOGL': { name: 'Alphabet Inc. (Google)', logo: 'https://companieslogo.com/img/orig/GOOG_BIG-63cbd9c6.png?t=1722952493' },
            'AMZN': { name: 'Amazon.com Inc.', logo: 'https://companieslogo.com/img/orig/AMZN_BIG.D-8fb0be81.png?t=1740113564' },
            'TSLA': { name: 'Tesla Inc.', logo: 'https://companieslogo.com/img/orig/TSLA-6da550e5.png?t=1740128273' },
            'NVDA': { name: 'NVIDIA Corporation', logo: 'https://companieslogo.com/img/orig/NVDA_BIG.D-ffbdc3fe.png?t=1722952498' },
            'META': { name: 'Meta Platforms Inc. (Facebook)', logo: 'https://companieslogo.com/img/orig/META-4767da84.png?t=1720244492' },
            'JPM': { name: 'JPMorgan Chase & Co.', logo: 'https://companieslogo.com/img/orig/JPM_BIG.D-62c873ed.png?t=1720244492' },
            'V': { name: 'Visa Inc.', logo: 'https://companieslogo.com/img/orig/V-05214186.png?t=1720244494' },
            'PYPL': { name: 'PayPal Holdings', logo: 'https://companieslogo.com/img/orig/PYPL_BIG-9eda417b.png?t=1720244493' },
            'WMT': { name: 'Walmart Inc.', logo: 'https://companieslogo.com/img/orig/WMT_BIG-4dae0070.png?t=1737085433' },
            'KO': { name: 'Coca-Cola Company', logo: 'https://companieslogo.com/img/orig/KO-b23a2a5e.png?t=1720244492' },
            'PEP': { name: 'PepsiCo Inc.', logo: 'https://logo.clearbit.com/pepsi.com' },
            'NKE': { name: 'Nike Inc.', logo: 'https://companieslogo.com/img/orig/NKE.D-14bad6cf.png?t=1720244493' },
            'DIS': { name: 'The Walt Disney Company', logo: 'https://companieslogo.com/img/orig/DIS_BIG.D-008fa6d9.png?t=1727153862' },
            'NFLX': { name: 'Netflix Inc.', logo: 'https://companieslogo.com/img/orig/NFLX_BIG-1095e4f6.png?t=1720244493' }
        };

        const stockElements = {};
        const tickerElements = {};

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initScrollerNavigation();
            setupEventListeners();
            connectWebSocket();
            fetchBitcoinData();
            initTicker();
            
            // Initialize stock elements mapping
            document.querySelectorAll('.stock-card').forEach(card => {
                const ticker = card.getAttribute('data-ticker');
                if (ticker) {
                    stockElements[ticker] = {
                        card: card,
                        priceElement: card.querySelector('.stock-price'),
                        nameElement: card.querySelector('.stock-name'),
                        symbolElement: card.querySelector('.stock-symbol'),
                        logoElement: card.querySelector('.stock-logo'),
                        tooltip: card.querySelector('.analysis-tooltip')
                    };
                }
            });
        });

        function initTicker() {
            // Initialize ticker with all tracked stocks
            Object.keys(trackedStocks).forEach(ticker => {
                const tickerItem = document.createElement('div');
                tickerItem.className = 'ticker-item';
                tickerItem.innerHTML = `
                    <span class="ticker-symbol">${ticker}</span>
                    <span class="ticker-price">$0.00</span>
                    <span class="ticker-change">(0.00%)</span>
                `;
                tickerContainer.appendChild(tickerItem);
                tickerElements[ticker] = {
                    element: tickerItem,
                    price: tickerItem.querySelector('.ticker-price'),
                    change: tickerItem.querySelector('.ticker-change')
                };
            });
        }

        function setupEventListeners() {
            // Search functionality
            document.getElementById('stockSearch').addEventListener('input', async function(e) {
                const searchTerm = e.target.value.trim().toUpperCase();
                const resultsContainer = document.getElementById('searchResults');
                
                if (searchTerm.length < 2) {
                    resultsContainer.style.display = 'none';
                    return;
                }
                
                try {
                    // Search Finnhub for symbols matching the term
                    const response = await fetch(`https://finnhub.io/api/v1/search?q=${searchTerm}&token=${FINNHUB_API_KEY}`);
                    const data = await response.json();
                    
                    resultsContainer.innerHTML = '';
                    
                    if (data.result && data.result.length > 0) {
                        // Show top 5 results
                        data.result.slice(0, 5).forEach(stock => {
                            const item = document.createElement('div');
                            item.className = 'search-result-item';
                            item.innerHTML = `
                                <span class="search-result-symbol">${stock.symbol}</span>
                                <span>${stock.description}</span>
                            `;
                            item.addEventListener('click', () => {
                                // Add to tracked stocks if not already there
                                if (!trackedStocks[stock.symbol]) {
                                    trackedStocks[stock.symbol] = {
                                        name: stock.description,
                                        logo: `https://companieslogo.com/img/orig/${stock.symbol}.D?t=${Date.now()}`
                                    };
                                }
                                openModal(stock.symbol);
                                resultsContainer.style.display = 'none';
                                e.target.value = '';
                            });
                            resultsContainer.appendChild(item);
                        });
                        resultsContainer.style.display = 'block';
                    } else {
                        resultsContainer.innerHTML = '<div class="search-result-item">No results found</div>';
                        resultsContainer.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Search error:', error);
                    resultsContainer.innerHTML = '<div class="search-result-item">Error loading results</div>';
                    resultsContainer.style.display = 'block';
                }
            });

            // Close search results when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    document.getElementById('searchResults').style.display = 'none';
                }
            });

            // Add click handlers to all stock cards
            document.querySelectorAll('.stock-card').forEach(card => {
                card.addEventListener('click', function() {
                    const ticker = this.getAttribute('data-ticker');
                    if (ticker) {
                        openModal(ticker);
                    }
                });
            });

            // Profile button functionality
            document.getElementById('profileBtn').addEventListener('click', function() {
                const currentUser = getCurrentUser();
                if (currentUser) {
                    window.location.href = 'profile/profile.html';
                } else {
                    window.location.href = 'profile/login.html';
                }
            });
        }

        function openModal(ticker) {
            const modal = document.getElementById('analysisModal');
            modal.style.display = 'block';
            
            // Set basic info immediately
            document.getElementById('companyName').textContent = trackedStocks[ticker]?.name || ticker;
            document.getElementById('currentPrice').textContent = 'Loading price data...';
            document.getElementById('aiSummary').textContent = 'Loading Cyber analysis...';
            
            // Set logo if available
            const modalLogo = document.getElementById('modalLogo');
            if (trackedStocks[ticker]?.logo) {
                modalLogo.src = trackedStocks[ticker].logo;
            } else {
                modalLogo.src = `https://via.placeholder.com/80?text=${ticker}`;
            }
            
            // Set up the recommendation display based on login status
            const recommendation = document.getElementById('buyRecommendation');
            const currentUser = getCurrentUser();
            
            if (currentUser) {
                recommendation.classList.remove('blurred');
                document.querySelector('.sign-in-prompt').style.display = 'none';
            } else {
                recommendation.classList.add('blurred');
                document.querySelector('.sign-in-prompt').style.display = 'block';
            }
            
            // Fetch and display all data
            fetchStockData(ticker);
        }

        function closeModal() {
            document.getElementById('analysisModal').style.display = 'none';
        }
        
        // Close modal when clicking outside content
        window.onclick = function(event) {
            const modal = document.getElementById('analysisModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        async function fetchStockData(ticker) {
            try {
                // Fetch all data in parallel
                const [profileResponse, quoteResponse, newsResponse] = await Promise.all([
                    fetch(`https://finnhub.io/api/v1/stock/profile2?symbol=${ticker}&token=${FINNHUB_API_KEY}`),
                    fetch(`https://finnhub.io/api/v1/quote?symbol=${ticker}&token=${FINNHUB_API_KEY}`),
                    fetchMarketauxNews(ticker)
                ]);
                
                const profileData = await profileResponse.json();
                const quoteData = await quoteResponse.json();
                const newsData = await newsResponse;
                
                // Update modal with the fetched data
                if (quoteData.c && quoteData.pc) {
                    const currentPrice = quoteData.c;
                    const prevClose = quoteData.pc;
                    const change = currentPrice - prevClose;
                    const percentChange = (change / prevClose * 100).toFixed(2);
                    
                    document.getElementById('currentPrice').innerHTML = `$${currentPrice.toFixed(2)} `;
                    if (change >= 0) {
                        document.getElementById('currentPrice').innerHTML += `<span class="price-up">(+${percentChange}%)</span>`;
                    } else {
                        document.getElementById('currentPrice').innerHTML += `<span class="price-down">(${percentChange}%)</span>`;
                    }
                    
                    // Update CNN chart
                    updateCNNChart(ticker);
                    
                    // Generate detailed analysis
                    generateDetailedAnalysis(ticker, currentPrice, prevClose, profileData, newsData);
                }
            } catch (error) {
                console.error('Error fetching stock data:', error);
                document.getElementById('aiSummary').textContent = 'Error loading data. Please try again later.';
            }
        }

        function updateCNNChart(ticker) {
            const cnnChart = document.getElementById('cnnChart');
            // CNN uses lowercase tickers in their URLs
            cnnChart.src = `https://www.cnn.com/markets/stocks/${ticker.toLowerCase()}`;
        }

        async function generateDetailedAnalysis(ticker, currentPrice, prevClose, profileData, newsData = []) {
            const aiSummary = document.getElementById('aiSummary');
            const metricsList = document.getElementById('keyMetrics');
            const newsSentiment = document.getElementById('newsSentiment');
            const newsContainer = document.getElementById('newsArticles');
            const recommendation = document.getElementById('buyRecommendation');
            
            // Calculate basic metrics
            const change = currentPrice - prevClose;
            const percentChange = (change / prevClose * 100).toFixed(2);
            const isPositive = change >= 0;
            
            // Generate summary
            let summaryText = `Our Cyber AI analysis for ${ticker} indicates ${isPositive ? 'positive' : 'negative'} momentum with a ${percentChange}% ${isPositive ? 'increase' : 'decrease'} from previous close. `;
            
            if (profileData.marketCapitalization) {
                summaryText += `The company has a market capitalization of $${(profileData.marketCapitalization / 1000000000).toFixed(2)}B. `;
            }
            
            if (profileData.industry) {
                summaryText += `It operates in the ${profileData.industry} industry. `;
            }
            
            // Update key metrics
            metricsList.innerHTML = '';
            metricsList.innerHTML += `<li>Current Price: $${currentPrice.toFixed(2)}</li>`;
            metricsList.innerHTML += `<li>Previous Close: $${prevClose.toFixed(2)}</li>`;
            metricsList.innerHTML += `<li>Daily Change: ${percentChange}%</li>`;
            
            if (profileData.marketCapitalization) {
                metricsList.innerHTML += `<li>Market Cap: $${(profileData.marketCapitalization / 1000000000).toFixed(2)}B</li>`;
            }
            
            if (profileData.country) {
                metricsList.innerHTML += `<li>Country: ${profileData.country}</li>`;
            }
            
            if (profileData.ipo) {
                metricsList.innerHTML += `<li>IPO Date: ${profileData.ipo}</li>`;
            }
            
            // News sentiment analysis and display
            if (newsData && newsData.length > 0) {
                // Clear previous news
                newsContainer.innerHTML = '';
                
                // Enhanced sentiment analysis keywords
                const positiveKeywords = [
                    'up', 'rise', 'gain', 'bullish', 'beat', 'positive', 'growth', 
                    'profit', 'success', 'win', 'strong', 'increase', 'surge',
                    'record', 'high', 'outperform', 'upgrade', 'buy', 'outperforms',
                    'exceeds', 'boosts', 'raises', 'improves', 'expansion'
                ];
                
                const negativeKeywords = [
                    'down', 'fall', 'drop', 'bearish', 'miss', 'negative', 'loss',
                    'decline', 'cut', 'reduce', 'weak', 'decrease', 'plunge',
                    'low', 'underperform', 'downgrade', 'sell', 'underperforms',
                    'fails', 'slump', 'crisis', 'warning', 'layoffs', 'bankruptcy'
                ];
                
                let positiveCount = 0;
                let negativeCount = 0;
                
                // Display up to 5 news articles
                newsData.slice(0, 5).forEach(news => {
                    if (!news.title) return;
                    
                    const headline = news.title.toLowerCase();
                    let sentiment = 'neutral';
                    
                    // Check for positive keywords
                    if (positiveKeywords.some(word => headline.includes(word))) {
                        positiveCount++;
                        sentiment = 'positive';
                    } 
                    // Check for negative keywords (only if not already positive)
                    else if (negativeKeywords.some(word => headline.includes(word))) {
                        negativeCount++;
                        sentiment = 'negative';
                    }
                    
                    // Create news article element
                    const article = document.createElement('div');
                    article.className = 'news-article';
                    article.innerHTML = `
                        <div class="news-title">${news.title || 'No title available'}</div>
                        ${news.source ? `<div class="news-source">Source: ${news.source}</div>` : ''}
                        ${news.description ? `<div class="news-summary">${news.description}</div>` : ''}
                        ${news.published_at ? `<div class="news-date">Published: ${new Date(news.published_at).toLocaleDateString()}</div>` : ''}
                        <div class="news-sentiment sentiment-${sentiment}">
                            Sentiment: ${sentiment.toUpperCase()}
                        </div>
                    `;
                    
                    // Add clickable link if URL exists
                    if (news.url) {
                        const link = document.createElement('a');
                        link.href = news.url;
                        link.target = '_blank';
                        link.textContent = 'Read full article →';
                        link.style.color = 'var(--neon-teal)';
                        link.style.display = 'block';
                        link.style.marginTop = '0.5rem';
                        article.appendChild(link);
                    }
                    
                    newsContainer.appendChild(article);
                });
                
                const totalNews = Math.min(newsData.length, 5);
                const neutralCount = totalNews - positiveCount - negativeCount;
                const sentimentScore = (positiveCount - negativeCount) / totalNews;
                
                newsSentiment.innerHTML = `Recent news sentiment: <strong>${sentimentScore > 0.2 ? 'Positive' : sentimentScore < -0.2 ? 'Negative' : 'Neutral'}</strong><br>
                    Positive: ${positiveCount}, Negative: ${negativeCount}, Neutral: ${neutralCount}`;
            } else {
                newsSentiment.textContent = 'No recent news available';
                newsContainer.innerHTML = '<p>No recent news articles found for this company.</p>';
            }
            
            aiSummary.textContent = summaryText;
            
            // Generate recommendation (simplified logic)
            let recommendationClass, recommendationText;
            
            if (isPositive && percentChange > 1) {
                recommendationClass = 'buy-yes';
                recommendationText = 'STRONG BUY';
            } else if (isPositive) {
                recommendationClass = 'buy-yes';
                recommendationText = 'BUY';
            } else if (!isPositive && percentChange < -1) {
                recommendationClass = 'buy-no';
                recommendationText = 'SELL';
            } else {
                recommendationClass = 'buy-hold';
                recommendationText = 'HOLD';
            }
            
            const currentUser = getCurrentUser();
            if (currentUser) {
                recommendation.className = 'buy-answer ' + recommendationClass;
                recommendation.textContent = recommendationText;
                document.querySelector('.sign-in-prompt').style.display = 'none';
            } else {
                recommendation.className = 'buy-answer blurred';
                recommendation.textContent = 'Cyber AI PROCESSING...';
                document.querySelector('.sign-in-prompt').style.display = 'block';
            }
        }

        async function fetchMarketauxNews(ticker) {
            try {
                // Use a more reliable CORS proxy
                const proxyUrl = 'https://api.allorigins.win/raw?url=';
                const encodedUrl = encodeURIComponent(`https://api.marketaux.com/v1/news/all?symbols=${ticker}&filter_entities=true&language=en&api_token=${MARKETAUX_API_KEY}`);
                
                const response = await fetch(proxyUrl + encodedUrl);
                
                if (!response.ok) {
                    throw new Error(`Marketaux API error: ${response.status}`);
                }
                
                const data = await response.json();
                return data.data || [];
            } catch (error) {
                console.error('Error fetching Marketaux news:', error);
                return [];
            }
        }

        function getCurrentUser() {
            // Implement your authentication logic here
            // This should return the current user or null if not logged in
            return null; // Replace with actual implementation
        }

        function redirectToLogin() {
            if (!getCurrentUser()) {
                window.location.href = 'profile/login.html';
            }
        }

        function connectWebSocket() {
            const socket = new WebSocket(`wss://ws.finnhub.io?token=${FINNHUB_API_KEY}`);
            
            socket.addEventListener('open', function (event) {
                console.log('Connected to Finnhub WebSocket');
                connectionStatus.textContent = "DATA: CONNECTED (Finnhub)";
                connectionStatus.classList.remove('disconnected');
                connectionStatus.classList.add('connected');
                
                // Subscribe to each stock's real-time updates
                Object.keys(trackedStocks).forEach(ticker => {
                    socket.send(JSON.stringify({'type':'subscribe', 'symbol': ticker}));
                });
                
                // Fetch initial prices for all stocks
                fetchInitialPrices();
            });

            socket.addEventListener('close', function (event) {
                console.log('Disconnected from Finnhub WebSocket');
                connectionStatus.textContent = "DATA: DISCONNECTED";
                connectionStatus.classList.remove('connected');
                connectionStatus.classList.add('disconnected');
            });

            socket.addEventListener('error', function (error) {
                console.error('WebSocket error:', error);
                connectionStatus.textContent = "DATA: ERROR";
            });

            // Listen for messages
            socket.addEventListener('message', function (event) {
                const data = JSON.parse(event.data);
                if (data.type === 'trade') {
                    // Process real-time trade data
                    data.data.forEach(trade => {
                        const ticker = trade.s;
                        const price = trade.p;
                        
                        if (stockElements[ticker]) {
                            updateStockCard(ticker, price);
                        }
                        if (tickerElements[ticker]) {
                            updateTicker(ticker, price);
                        }
                    });
                }
            });
        }

        async function fetchInitialPrices() {
            for (const ticker of Object.keys(trackedStocks)) {
                try {
                    // Fetch quote data
                    const quoteResponse = await fetch(`https://finnhub.io/api/v1/quote?symbol=${ticker}&token=${FINNHUB_API_KEY}`);
                    const quoteData = await quoteResponse.json();
                    
                    if (quoteData.c && quoteData.pc) {
                        updateStockCard(ticker, quoteData.c, quoteData.pc);
                        updateTicker(ticker, quoteData.c);
                    }
                } catch (error) {
                    console.error(`Error fetching initial price for ${ticker}:`, error);
                }
            }
        }

        function updateStockCard(ticker, currentPrice, previousClose) {
            const stock = stockElements[ticker];
            if (!stock) return;
            
            // Calculate change if we have previous close
            if (previousClose !== undefined) {
                const change = currentPrice - previousClose;
                const percentChange = (change / previousClose * 100).toFixed(2);
                
                stock.card.dataset.currentPrice = currentPrice;
                stock.card.dataset.previousClose = previousClose;
                stock.card.dataset.percentChange = percentChange;
                
                // Update the DOM
                stock.priceElement.innerHTML = `$${currentPrice.toFixed(2)} `;
                
                if (change >= 0) {
                    stock.priceElement.innerHTML += `<span class="price-up">(+${percentChange}%)</span>`;
                } else {
                    stock.priceElement.innerHTML += `<span class="price-down">(${percentChange}%)</span>`;
                }
            } else {
                // Just show current price if we don't have change data
                stock.priceElement.textContent = `$${currentPrice.toFixed(2)}`;
                stock.card.dataset.currentPrice = currentPrice;
            }
        }

        function updateTicker(ticker, currentPrice) {
            const element = tickerElements[ticker];
            if (!element) return;
            
            const stock = stockElements[ticker];
            const previousClose = stock?.card.dataset.previousClose || currentPrice;
            const change = currentPrice - previousClose;
            const percentChange = (change / previousClose * 100).toFixed(2);
            
            element.price.textContent = `$${currentPrice.toFixed(2)}`;
            element.change.textContent = `(${percentChange}%)`;
            
            if (change >= 0) {
                element.change.classList.add('price-up');
                element.change.classList.remove('price-down');
            } else {
                element.change.classList.add('price-down');
                element.change.classList.remove('price-up');
            }
        }

        async function fetchBitcoinData() {
            try {
                const response = await fetch(`${COINGECKO_API_URL}simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true`);
                const data = await response.json();
                
                if (data.bitcoin) {
                    const btc = data.bitcoin;
                    const priceElement = document.getElementById('btc-price');
                    const changeElement = document.getElementById('btc-change');
                    const volumeElement = document.getElementById('btc-volume');
                    
                    priceElement.textContent = `$${btc.usd.toLocaleString()}`;
                    
                    if (btc.usd_24h_change >= 0) {
                        changeElement.textContent = `(+${btc.usd_24h_change.toFixed(2)}%)`;
                        changeElement.className = 'ticker-change price-up';
                    } else {
                        changeElement.textContent = `(${btc.usd_24h_change.toFixed(2)}%)`;
                        changeElement.className = 'ticker-change price-down';
                    }
                    
                    volumeElement.textContent = `$${(btc.usd_24h_vol / 1000000).toFixed(2)}M`;
                }
            } catch (error) {
                console.error('Error fetching Bitcoin data:', error);
            }
            
            // Update every 30 seconds
            setTimeout(fetchBitcoinData, 30000);
        }

        // Scroller Navigation Implementation
        function initScrollerNavigation() {
            const scrollContainer = document.getElementById('stock-scroller');
            const scrollLeftButton = document.getElementById('scroll-left');
            const scrollRightButton = document.getElementById('scroll-right');
            
            // Debounce function for scroll events
            function debounce(func, wait, immediate) {
                let timeout;
                return function() {
                    const context = this, args = arguments;
                    const later = function() {
                        timeout = null;
                        if (!immediate) func.apply(context, args);
                    };
                    const callNow = immediate && !timeout;
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                    if (callNow) func.apply(context, args);
                };
            }

            // Smooth scroll animation using requestAnimationFrame
            function smoothScrollTo(element, target, duration) {
                const start = element.scrollLeft;
                const change = target - start;
                const startTime = performance.now();
                
                function animateScroll(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    element.scrollLeft = start + change * progress;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animateScroll);
                    }
                }
                
                requestAnimationFrame(animateScroll);
            }

            function updateArrowStates() {
                if (!scrollContainer) return;
                
                // Check if scrolling is possible to the left
                const canScrollLeft = scrollContainer.scrollLeft > 0;
                scrollLeftButton.disabled = !canScrollLeft;

                // Check if scrolling is possible to the right
                const canScrollRight = scrollContainer.scrollLeft < (scrollContainer.scrollWidth - scrollContainer.clientWidth - 1);
                scrollRightButton.disabled = !canScrollRight;
            }

            // Event listeners for scroll buttons
            scrollLeftButton.addEventListener('click', () => {
                const scrollAmount = -scrollContainer.clientWidth / 2;
                const target = scrollContainer.scrollLeft + scrollAmount;
                smoothScrollTo(scrollContainer, target, 300);
            });

            scrollRightButton.addEventListener('click', () => {
                const scrollAmount = scrollContainer.clientWidth / 2;
                const target = scrollContainer.scrollLeft + scrollAmount;
                smoothScrollTo(scrollContainer, target, 300);
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    e.preventDefault(); 
                    scrollContainer.scrollBy({ left: -200, behavior: 'smooth' });
                } else if (e.key === 'ArrowRight') {
                    e.preventDefault(); 
                    scrollContainer.scrollBy({ left: 200, behavior: 'smooth' });
                }
            });
            
            // Mouse wheel/swipe scrolling for the container
            if (scrollContainer) {
                let isDown = false;
                let startX;
                let scrollLeft;

                scrollContainer.addEventListener('mousedown', (e) => {
                    isDown = true;
                    startX = e.pageX - scrollContainer.offsetLeft;
                    scrollLeft = scrollContainer.scrollLeft;
                    scrollContainer.style.cursor = 'grabbing';
                });

                scrollContainer.addEventListener('mouseleave', () => {
                    isDown = false;
                    scrollContainer.style.cursor = 'grab';
                });

                scrollContainer.addEventListener('mouseup', () => {
                    isDown = false;
                    scrollContainer.style.cursor = 'grab';
                });

                scrollContainer.addEventListener('mousemove', (e) => {
                    if (!isDown) return;
                    e.preventDefault();
                    const x = e.pageX - scrollContainer.offsetLeft;
                    const walk = (x - startX) * 2;
                    scrollContainer.scrollLeft = scrollLeft - walk;
                });

                scrollContainer.addEventListener('wheel', (event) => {
                    let scrollAmount = 0;
                    if (event.deltaX !== 0) {
                        scrollAmount = event.deltaX;
                    } else if (event.deltaY !== 0) {
                        scrollAmount = event.deltaY;
                        event.preventDefault();
                    }

                    if (scrollAmount !== 0) {
                        scrollContainer.scrollLeft += scrollAmount;
                    }
                }, { passive: false });

                // Update arrow states on any scroll event (debounced)
                scrollContainer.addEventListener('scroll', debounce(updateArrowStates, 100));
            }
            
            // Initial setup
            updateArrowStates();
        }
    </script>
</body>
</html>
