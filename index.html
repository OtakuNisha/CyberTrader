<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantumTrader | AI Stock Market Game</title>
    <!-- Three.js for 3D models -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* [Keep all your original CSS styles exactly as they are] */
        
        /* Add these new styles for 3D containers and news ticker */
        .logo-container-3d {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
        }
        
        .news-ticker {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.7);
            border-top: 1px solid var(--neon-purple);
            overflow: hidden;
            padding: 0.5rem 0;
        }
        
        .news-content {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            animation: ticker 30s linear infinite;
            color: var(--neon-teal);
            font-family: 'Orbitron', sans-serif;
        }
        
        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--neon-teal);
            font-family: 'Orbitron', sans-serif;
            display: none;
        }
    </style>
</head>
<body>
    <div class="grid-overlay"></div>
    <div class="container">
        <header class="header">
            <div class="logo">QUANTUMTRADER</div>
            <button class="profile-btn">PROFILE</button>
        </header>
        
        <main class="market-overview">
            <h2 class="section-title">MARKET OVERVIEW</h2>
            
            <div id="loading" class="loading">
                INITIALIZING QUANTUM CONNECTION...
            </div>
            
            <div class="scroller">
                <div class="scroller-inner" id="stocks-container">
                    <!-- Stocks will be dynamically inserted here -->
                </div>
            </div>
        </main>
    </div>
    
    <!-- Keep your existing modal HTML exactly as is -->
    
    <div class="news-ticker">
        <div class="news-content" id="news-ticker-content">
            Loading financial news updates...
        </div>
    </div>
    
    <div id="connectionStatus" class="connection-status disconnected">
        DATA: CONNECTING...
    </div>

    <script>
        // ======================
        // CONFIGURATION
        // ======================
        const API_KEY = 'd0uelbpr01qn5fk4u25gd0uelbpr01qn5fk4u260'; // Replace with your actual key
        const STOCKS = ['AAPL', 'MSFT', 'GOOG', 'AMZN', 'TSLA', 'NVDA', 'META', 'JPM', 'BAC', 'DIS'];
        
        // ======================
        // 3D LOGO RENDERER
        // ======================
        function init3DLogo(container, ticker) {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(100, 100);
            container.appendChild(renderer.domElement);
            
            // Create basic 3D shape (replace with actual logo model later)
            const geometry = new THREE.TorusGeometry(7, 3, 16, 100);
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x00ffcc,
                emissive: 0x003333,
                specular: 0x555555,
                shininess: 30
            });
            
            const logo = new THREE.Mesh(geometry, material);
            scene.add(logo);
            
            // Add lighting
            const light1 = new THREE.DirectionalLight(0xffffff, 1);
            light1.position.set(1, 1, 1);
            scene.add(light1);
            
            const light2 = new THREE.AmbientLight(0x404040);
            scene.add(light2);
            
            camera.position.z = 20;
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                logo.rotation.x += 0.01;
                logo.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
        }

        // ======================
        // REAL-TIME DATA FETCHING
        // ======================
        async function fetchStockData() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('connectionStatus').textContent = "DATA: CONNECTING...";
                
                // Fetch quotes
                const quotes = await Promise.all(
                    STOCKS.map(ticker => 
                        fetch(`https://finnhub.io/api/v1/quote?symbol=${ticker}&token=${API_KEY}`)
                            .then(res => res.json())
                    )
                );
                
                // Fetch company profiles
                const profiles = await Promise.all(
                    STOCKS.map(ticker =>
                        fetch(`https://finnhub.io/api/v1/stock/profile2?symbol=${ticker}&token=${API_KEY}`)
                            .then(res => res.json())
                    )
                );
                
                // Fetch latest news
                const news = await fetch(`https://finnhub.io/api/v1/news?category=general&token=${API_KEY}`)
                    .then(res => res.json());
                
                return { quotes, profiles, news };
            } catch (error) {
                console.error("Error fetching data:", error);
                return null;
            }
        }

        // ======================
        // RENDER STOCKS
        // ======================
        function renderStocks(data) {
            const container = document.getElementById('stocks-container');
            container.innerHTML = '';
            
            data.quotes.forEach((quote, index) => {
                const ticker = STOCKS[index];
                const profile = data.profiles[index];
                const changePercent = ((quote.c - quote.pc) / quote.pc * 100).toFixed(2);
                
                const card = document.createElement('div');
                card.className = 'stock-card';
                card.onclick = () => openModal(ticker, quote, profile);
                
                card.innerHTML = `
                    <div class="logo-container-3d" id="logo-${ticker}"></div>
                    <h3 class="stock-name">${profile.name}</h3>
                    <div class="stock-price ${changePercent >= 0 ? 'price-up' : 'price-down'}">
                        $${quote.c.toFixed(2)} (${changePercent >= 0 ? '+' : ''}${changePercent}%)
                    </div>
                `;
                
                container.appendChild(card);
                init3DLogo(document.getElementById(`logo-${ticker}`), ticker);
            });
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('connectionStatus').textContent = "DATA: CONNECTED (Live)";
            document.getElementById('connectionStatus').className = "connection-status connected";
        }
        
        function renderNews(news) {
            const tickerContent = document.getElementById('news-ticker-content');
            tickerContent.innerHTML = news.slice(0, 5).map(item => 
                `â€¢ ${item.headline} (${new Date(item.datetime*1000).toLocaleTimeString()}) | `
            ).join('');
        }

        // ======================
        // ENHANCED MODAL FUNCTIONS
        // ======================
        function openModal(ticker, quote, profile) {
            const modal = document.getElementById('analysisModal');
            
            // Update modal content with real data
            document.getElementById('modalLogo').textContent = ticker;
            document.getElementById('companyName').textContent = profile.name;
            document.getElementById('currentPrice').textContent = 
                `$${quote.c.toFixed(2)} (${((quote.c - quote.pc)/quote.pc*100).toFixed(2)}%)`;
            
            // Generate AI analysis (simplified example)
            const analysis = generateAIAnalysis(quote, profile);
            document.getElementById('aiSummary').textContent = analysis.summary;
            
            // Update metrics
            const metricsList = document.getElementById('keyMetrics');
            metricsList.innerHTML = [
                `52-Week Range: $${quote.l.toFixed(2)} - $${quote.h.toFixed(2)}`,
                `Market Cap: $${(profile.marketCapitalization/1000000000).toFixed(2)}B`,
                `P/E Ratio: ${profile.pe || 'N/A'}`,
                `Volume: ${(quote.v/1000000).toFixed(2)}M`
            ].map(item => `<li>${item}</li>`).join('');
            
            // Show recommendation
            const recommendation = document.getElementById('buyRecommendation');
            recommendation.className = 'buy-answer ' + 
                (analysis.recommendation === 'buy' ? 'buy-yes' : 'buy-no');
            recommendation.textContent = analysis.recommendation === 'buy' ? 'BUY' : 'HOLD';
            
            // Show modal
            modal.style.display = 'block';
        }
        
        function generateAIAnalysis(quote, profile) {
            // Simplified AI logic - replace with your actual analysis
            const changePercent = ((quote.c - quote.pc) / quote.pc) * 100;
            const isUndervalued = profile.pe && profile.pe < 25;
            const isGrowing = changePercent > 2;
            
            return {
                summary: `Our AI analysis indicates ${profile.name} is ${isUndervalued ? 'undervalued' : 'fairly valued'} ` +
                         `with ${isGrowing ? 'strong' : 'moderate'} recent performance. ` +
                         `The ${isUndervalued && isGrowing ? 'risk/reward ratio appears favorable' : 'valuation seems reasonable'}.`,
                recommendation: isUndervalued && isGrowing ? 'buy' : 'hold'
            };
        }

        // Keep your existing closeModal() and window.onclick functions

        // ======================
        // INITIALIZATION
        // ======================
        document.addEventListener('DOMContentLoaded', async () => {
            // First load
            const data = await fetchStockData();
            if (data) {
                renderStocks(data);
                renderNews(data.news);
            } else {
                document.getElementById('connectionStatus').textContent = "DATA: OFFLINE (Using cached data)";
                // You could load cached data here
            }
            
            // Update every 30 seconds
            setInterval(async () => {
                const newData = await fetchStockData();
                if (newData) {
                    renderStocks(newData);
                    renderNews(newData.news);
                }
            }, 30000);
        });
    </script>
</body>
</html>
